<!-- ADD LEASE: app/templates/leases/add.html -->
{% extends "base.html" %}

{% block title %}{% if lease %}Edit{% else %}Add{% endif %} Lease - RentalHub{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto fade-in">
    <div class="mb-8">
        <a href="{{ url_for('leases.list_leases') }}" class="text-indigo-600 hover:text-indigo-700 mb-4 inline-block">
            <i class="fas fa-arrow-left mr-2"></i>Back to Leases
        </a>
        <h1 class="text-3xl font-bold text-gray-800">
            <i class="fas fa-file-signature text-indigo-600 mr-3"></i>{% if lease %}Edit{% else %}Create New{% endif %} Lease
        </h1>
    </div>
    
    <div class="bg-white rounded-xl shadow-md p-8">
        <form method="POST">
            <!-- Property & Tenant Selection -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 pb-2 border-b">
                    <i class="fas fa-handshake text-indigo-600 mr-2"></i>Lease Parties
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">
                            Property <span class="text-red-500">*</span>
                        </label>
                        <select name="property_id" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <option value="">Select Property</option>
                            {% for property in properties %}
                                <option value="{{ property.id }}" {% if lease and lease.property_id == property.id %}selected{% endif %}>
                                    {{ property.property_type|title }} - {{ property.address }} ({{ property.city }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">
                            Tenant <span class="text-red-500">*</span>
                        </label>
                        <select name="tenant_id" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <option value="">Select Tenant</option>
                            {% for tenant in tenants %}
                                <option value="{{ tenant.id }}" {% if lease and lease.tenant_id == tenant.id %}selected{% endif %}>
                                    {{ tenant.user.username }} - {{ tenant.user.email }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Lease Terms -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 pb-2 border-b">
                    <i class="fas fa-calendar-alt text-indigo-600 mr-2"></i>Lease Terms
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">
                            Start Date <span class="text-red-500">*</span>
                        </label>
                        <input type="date" name="start_date" required 
                               value="{% if lease %}{{ lease.start_date.strftime('%Y-%m-%d') }}{% endif %}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">
                            End Date <span class="text-red-500">*</span>
                        </label>
                        <input type="date" name="end_date" required 
                               value="{% if lease %}{{ lease.end_date.strftime('%Y-%m-%d') }}{% endif %}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">
                            Monthly Rent ($) <span class="text-red-500">*</span>
                        </label>
                        <input type="number" name="monthly_rent" required min="0" step="0.01"
                               value="{% if lease %}{{ lease.monthly_rent }}{% endif %}"
                               placeholder="1500.00"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">
                            Security Deposit ($)
                        </label>
                        <input type="number" name="security_deposit" min="0" step="0.01"
                               value="{% if lease %}{{ lease.security_deposit or 0 }}{% endif %}"
                               placeholder="1500.00"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">
                            Lease Status <span class="text-red-500">*</span>
                        </label>
                        <select name="status" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <option value="active" {% if lease and lease.status == 'active' %}selected{% endif %}>Active</option>
                            <option value="expired" {% if lease and lease.status == 'expired' %}selected{% endif %}>Expired</option>
                            <option value="terminated" {% if lease and lease.status == 'terminated' %}selected{% endif %}>Terminated</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Terms & Conditions -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 pb-2 border-b">
                    <i class="fas fa-file-alt text-indigo-600 mr-2"></i>Terms & Conditions
                </h3>
                
                <textarea name="terms_conditions" rows="6" 
                          placeholder="Enter lease terms and conditions..."
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">{% if lease %}{{ lease.terms_conditions }}{% endif %}</textarea>
            </div>
            
            <!-- Submit -->
            <div class="flex space-x-4">
                <button type="submit" class="flex-1 bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition font-semibold">
                    <i class="fas fa-save mr-2"></i>{% if lease %}Update{% else %}Create{% endif %} Lease
                </button>
                <a href="{{ url_for('leases.list_leases') }}" 
                   class="flex-1 bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 transition font-semibold text-center">
                    <i class="fas fa-times mr-2"></i>Cancel
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

<!-- For EDIT, create app/templates/leases/edit.html with same content, just include lease variable -->